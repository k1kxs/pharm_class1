# Серверная часть для приложения классификации лекарственных препаратов

## Описание
Серверная часть реализует API для аутентификации и хранения данных классификации лекарственных препаратов.

## Функциональность
- Безопасная аутентификация пользователей с использованием JWT токенов
- Хеширование паролей с помощью bcrypt
- Защита от брутфорс-атак с ограничением количества попыток входа
- Хранение данных о пользователях и классификации в MongoDB
- Ролевая система (пользователи и администраторы)
- API для управления данными классификации

## Требования
- Node.js 14+
- MongoDB
- npm или yarn

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Настройте переменные окружения, создав файл .env:
```
PORT=5000
MONGODB_URI=mongodb://localhost:27017/drug-classification
JWT_SECRET=ваш_секретный_ключ_для_jwt
ADMIN_INIT_KEY=специальный_ключ_для_создания_админа
```

3. Запустите сервер в режиме разработки:
```bash
npm run dev
```

4. Для продакшн-сборки выполните:
```bash
npm run build
npm start
```

## Инициализация администратора

При первом запуске необходимо создать администратора, отправив POST-запрос на endpoint `/api/auth/init-admin`:

```json
{
  "initKey": "специальный_ключ_для_создания_админа",
  "username": "admin",
  "email": "admin@example.com",
  "password": "надежный_пароль"
}
```

Значение `initKey` должно совпадать с `ADMIN_INIT_KEY` из .env файла.

## API Endpoints

### Аутентификация

- `POST /api/auth/login` - вход в систему
- `GET /api/auth/me` - получение информации о текущем пользователе
- `POST /api/auth/change-password` - изменение пароля
- `POST /api/auth/register` - регистрация нового пользователя (только для администраторов)
- `POST /api/auth/init-admin` - создание начального администратора

### Данные классификации

- `GET /api/data` - получение данных классификации
- `POST /api/data` - сохранение данных классификации
- `GET /api/data/history` - получение истории версий (только для администраторов)
- `POST /api/data/import` - импорт данных (только для администраторов)

## Безопасность

Сервер обеспечивает следующие меры безопасности:

1. Хеширование паролей с использованием bcrypt
2. JWT токены с ограниченным сроком действия (24 часа)
3. Защита от брутфорс-атак с временной блокировкой учетной записи
4. Проверка ролей для доступа к защищенным ресурсам
5. Безопасное хранение данных в MongoDB

## Развертывание

Для развертывания в продакшн-среде рекомендуется:

1. Настроить SSL/TLS для HTTPS
2. Использовать обратный прокси-сервер (например, Nginx)
3. Настроить MongoDB с аутентификацией
4. Изменить все секретные ключи в .env файле на уникальные и надежные значения
5. Регулярно обновлять зависимости для устранения уязвимостей 